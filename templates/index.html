<!-- templates/index.html -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SmartEstimator AI — Week 5 · Day 24.1</title>
    <link rel="icon" href="data:,">
    <style>
      :root { --ink:#0f172a; --muted:#64748b; --bg:#f8fafc; --card:#ffffff; --acc:#111827; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--ink); }
      .wrap { max-width: 920px; margin: 30px auto; background:var(--card); padding:28px; border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,.08); }
      label { font-weight: 600; }
      input[type="number"], select, textarea { width:100%; padding:10px; margin:8px 0 16px; border:1px solid #e5e7eb; border-radius:10px; }
      .row { display:flex; gap:18px; }
      .col { flex:1; }
      .note { background:#eef6ff; border:1px dashed #84a9ff; padding:12px 14px; border-radius:10px; color:#173b6d; }
      .btn { background:var(--acc); color:#fff; border:0; padding:12px 18px; border-radius:10px; cursor:pointer; }
      .small { color:var(--muted); font-size:12px; }
      .links a { display:inline-block; margin-right:12px; }
      code { background:#f1f5f9; padding:2px 6px; border-radius:6px; }
      .card { margin-top:18px; padding:14px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h2>SmartEstimator AI — Week 5 · Day 24.1 (Manual Scale Override v1)</h2>
      <p class="note">
        <strong>Note:</strong> Provide one known measurement (width or height) if OCR fails to detect scale.
      </p>

      <form action="/estimate" method="post" enctype="multipart/form-data">
        <label>Plan file (image or PDF)</label><br/>
        <input type="file" name="plan" required/>

        <div class="row">
          <div class="col">
            <label>India wall height (ft)</label>
            <input type="number" step="0.1" name="in_height" value="10"/>
          </div>
          <div class="col">
            <label>USA wall height (ft)</label>
            <input type="number" step="0.1" name="us_height" value="8"/>
          </div>
        </div>

        <label>Mode</label>
        <select name="mode">
          <option value="india">india</option>
          <option value="usa">usa</option>
          <option value="both" selected>both</option>
        </select>

        <label>Optional price overrides (JSON)</label>
        <textarea name="prices_json" rows="7" placeholder='{"GLOBAL":{"currency":"INR"}}'></textarea>

        <label>Optional: Known overall dimension (ft)</label>
        <div class="row">
          <div class="col">
            <label>Known Width (ft)</label>
            <input type="number" step="0.1" name="known_width_ft" placeholder="e.g. 30.25">
          </div>
          <div class="col">
            <label>Known Height (ft)</label>
            <input type="number" step="0.1" name="known_height_ft" placeholder="e.g. 46.0">
          </div>
        </div>

        <button class="btn" type="submit">Estimate</button>
      </form>

      {% if last_status %}
        <div class="card">
          <h3>Last Run</h3>
          <p><b>Run ID:</b> {{ last_status.run_id }}</p>
          <p><b>OCR geometry used:</b>
            {% if last_status.ocr_geometry_used %} ✅ Yes {% else %} ❌ No (fallback) {% endif %}
          </p>
          <p><b>Scale:</b>
            {% if last_status.scale_ft_per_px %} {{ "%.6f"|format(last_status.scale_ft_per_px) }} ft/px
            {% else %} n/a {% endif %}
          </p>
          <p>
            <b>Total Area:</b> {{ last_status.totals.total_area_ft2 }} ft² ·
            <b>Total Perimeter:</b> {{ last_status.totals.total_perimeter_ft }} ft ·
            <b>Total Wall Length:</b> {{ last_status.totals.total_wall_length_ft }} ft
          </p>
          <p class="links">
            <a href="/runs/{{ last_status.run_id }}/status.json">status.json</a> |
            <a href="/runs/{{ last_status.run_id }}/metrics/metrics_area.json">metrics_area.json</a> |
            <a href="/runs/{{ last_status.run_id }}/metrics/metrics_walls.json">metrics_walls.json</a>
          </p>
        </div>
      {% endif %}

      <p class="small" style="margin-top:16px;">Health: <a href="/health">/health</a></p>
    </div>
  </body>
</html>
